version: '2'
services:
  tinkuy-nodebb:
    restart: always
    build: ./nodebb
    links:
      - tinkuy-redis
    volumes:
      - ./config/nodebb.config.json:/nodebb/config.json:ro
      - tinkuy-nodebb:/nodebb/public/uploads
  tinkuy-redis:
    restart: always
    image: redis:3
    volumes: 
      - tinkuy-redis:/data
  couchdb:
    restart: always
    image: couchdb:1
    volumes: 
      - couchdb:/usr/local/var/lib/couchdb
  rasmuserik-mysql:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD: $PW1
    volumes:
      - rasmuserik-mysql:/var/lib/mysql
  rasmuserik:
    restart: always
    image: wordpress
    links:
      - rasmuserik-mysql
    environment:
      WORDPRESS_DB_HOST: rasmuserik-mysql
      WORDPRESS_DB_PASSWORD: $PW1
    ports:
      - 8001:80
    volumes:
      - rasmuserik-wordpress:/var/www/html
  caddy:
    restart: always
    build: ./caddy
    links:
      - tinkuy-nodebb
      - couchdb
      - rasmuserik
    volumes: 
      - ./config/Caddyfile:/caddy/Caddyfile:ro
      - caddy:/root/.caddy
    ports:
      - "0.0.0.0:80:80"
      - "0.0.0.0:443:443"
volumes:
  caddy: {"driver": "local"}
  couchdb: {"driver": "local"}
  tinkuy-nodebb: {"driver": "local"}
  tinkuy-redis: {"driver": "local"}
  rasmuserik-wordpress: {"driver": "local"}
  rasmuserik-mysql: {"driver": "local"}
